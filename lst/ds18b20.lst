C51 COMPILER V9.01   DS18B20                                                               03/20/2024 01:22:19 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\obj\ds18b20.obj
COMPILER INVOKED BY: D:\MyProgrammeSetUp\KEILC51\C51\BIN\C51.EXE src\drive\ds18b20.c LARGE BROWSE INCDIR(..\final_projec
                    -ts;.\src;.\src\app;.\src\drive;.\src\include) DEBUG OBJECTEXTEND PRINT(.\lst\ds18b20.lst) OBJECT(.\obj\ds18b20.obj)

line level    source

   1          #include"ds18b20.h"
   2          
   3          /*---------------------------------ÑÓÊ±º¯Êı----------------------------------------------------*/
   4          //ÏÂÃæĞ´staticÊÇÒòÎªÖ»ÒªÕâ¸öº¯ÊıÔÚ±¾ÎÄ¼şÖĞ¿É¼û¾ÍĞĞÁË
   5          static void delay700us(void)   //ÑÓÊ±700us£¬×¨ÃÅÎªinitÀïÃæµÄÑÓÊ±Éè¼ÆµÄ
   6          {
   7   1          unsigned char a,b;
   8   1          for(b=139;b>0;b--)
   9   1              for(a=1;a>0;a--);
  10   1      }
  11          
  12          static void delay15us(void)   //ÑÓÊ±15us£¬×¨ÃÅÊÇÎªÁË³õÊ¼»¯Ö®ºó£¬¸ødsport½«¸ßµçÆ½À­µÍÎªµÍµçÆ½Éè¼ÆµÄ
  13          {
  14   1          unsigned char a;
  15   1          for(a=15;a>0;a--);
  16   1      }
  17          
  18          static void delay45us(void)   //Îó²î45us,×¨ÃÅÎªÁËreadbyteº¯ÊıÉè¼ÆµÄ£¬²ÉÑùÖ®ºó±ØĞëÒª³ÖĞø45us
  19          {
  20   1          unsigned char a;
  21   1          for(a=20;a>0;a--);
  22   1      }
  23          
  24          static void delay70us(void)   //Îó²î 70us£¬×¨ÃÅÊÇÎªÁËwritebyteº¯ÊıÉè¼ÆµÄ£¬ÖÁÉÙ³ÖĞø68us
  25          {
  26   1          unsigned char a,b;
  27   1          for(b=13;b>0;b--)
  28   1              for(a=1;a>0;a--);
  29   1      }
  30          
  31          static void delay1ms(void)   //Îó²î1ms,ÎªÁËÔÚds18b20ADCÀïÃæ³õÊ¼»¯ºó×ª»»ÎÂ¶ÈÓÃ
  32          {
  33   1          unsigned char a,b;
  34   1          for(b=199;b>0;b--)
  35   1              for(a=1;a>0;a--);
  36   1      }
  37          
  38          static void delay750ms(void)   //Îó²î 750ms
  39          {
  40   1          unsigned char a,b,c;
  41   1          for(c=61;c>0;c--)
  42   1              for(b=28;b>0;b--)
  43   1                  for(a=218;a>0;a--);
  44   1      }
  45          
  46          
  47          /*---------------------------------µ×²ãº¯Êı----------------------------------------------------*/
  48          /*---------³õÊ¼»¯--------------*/
  49          
  50          static uchar Ds18b20Init(){//³õÊ¼»¯¾ÍÊÇÌ½²âÕâ¸öĞ¾Æ¬ÔÚ²»ÔÚ£¬×ÜÏßÏÈ»á´Ó0µ½1µÄ±ä»¯£¬Èç¹ûĞ¾Æ¬ÔÚµÄ»°»áÖ÷¶¯×ÜÏßµ
             -ÄĞ¾Æ¬µÄÀ­µÍµÄ
  51   1                                              //·µ»Ø½á¹ûÊÇ1±íÊ¾³É¹¦£¬0´ú±íÊ§°Ü
  52   1              uchar i = 0;
  53   1              DSPORT = 0;     //ÏÈ½«Õâ¸ö×ÜÏßÀ­µÍ£¬µÍµçÆ½480us-960us×ÜÏßËùÓĞµÄÆ÷¼ş¾Í»á¸´Î»
C51 COMPILER V9.01   DS18B20                                                               03/20/2024 01:22:19 PAGE 2   

  54   1              delay700us();//ÑÓÊ±700us£¬ËùÓĞÆ÷¼ş¸´Î»ÁË
  55   1              DSPORT = 1;//µ¥Æ¬»ú½«µçÆ½À­¸ß£¬Èç¹ûds18b20´æÔÚµÄ»°£¬µÈ15--60usÕâ¸öÊ±¼ä·¶Î§Ö®ÄÚ£¬±Ø¶¨»á½«DSPORTÀ­µÍ¡£´í¹ı1
             -5usµ½60usÕâ¸ö´°¿ÚÆÚ¾ÍÃ»°ì·¨»ñÈ¡µ½À­µÍÃ»ÓĞ¡£
  56   1              i = 0;
  57   1              while(DSPORT){ //Èç¹ûÓĞds18b20À­µÍÁËÄÇÃ´¾ÍÊÇÓĞ ds18b20´æÔÚ£¬Ë«·½¿ÉÒÔÍ¨ĞÅ
  58   2                      i++;
  59   2                      if(i > 5){ //µÈ´ı³¬Ê±ÁË£¬Îå´Î¼ì²é¶¼Ã»ÓĞ·¢ÏÖDSPORTÎª0¾ÍÖ±½ÓÍË³ö
  60   3                              return 0;//³õÊ¼»¯Ê§°Ü
  61   3                      }
  62   2                      delay15us();//ºÍÉÏÃæi>5Áª¶¯£¬µÈ´ıµÄÊ±¼äÊÇ15us--60us             
  63   2              }
  64   1              return 1;//³õÊ¼»¯³É¹¦           
  65   1      }
  66          
  67          /*-----------Ğ´º¯Êı(ÒÀ¾İÊ±Ğò°æ)--------------*/
  68          static void Ds18b20WriteByte(uchar dat){//Ğ´µÄÊ±ºòÈ¨Á¦¶¼ÔÚmcuÊÖÖĞ£¬mcu¿ØÖÆÕ¼¾İ×ÜÏß      
  69   1              uint i = 0,j = 0;
  70   1              for(j = 0;j < 8;++j){
  71   2                      DSPORT = 0;//ÏÈ´Ó¸ßµçÆ½À­µÍµ½µÍµçÆ½ÖÁÉÙ1us´ú±í¿ªÊ¼
  72   2                      i++;//ÆğÑÓÊ±1us×÷ÓÃ
  73   2                      DSPORT= dat & 0x01;     //¡¾×¢ÒâÊÇ´Ó×îµÍÎ»¿ªÊ¼¶ÁÈ¡µÄ¡¿
  74   2                      delay70us();//µ¥Æ¬»ú´Ó¸ßµ½µÍµÄÊ±¼ä + dsport³ÖĞø·¢ËÍĞÅºÅµÄÊ±¼ä×Ü¹²ºÄÊ±ÖÁÉÙÊÇ60us£¬Õâ¸öÑ­»·ºÄÊ±ÊÇ68us£¬Ö»Ä
             -Ü¶à²»ÄÜÉÙ¡£
  75   2                      DSPORT = 1;//¶Á³ö½á¹ûÁË£¬ÊÍ·Å×ÜÏß
  76   2                      dat = dat >> 1;//¼È´ïµ½ÁËÑÓÊ±1usµÄÒªÇó£¬»¹´ïµ½ÁËÎ»ÒÆdat·½±ãÏÂ´ÎÑ­»·             
  77   2              }
  78   1      }
  79          /*-----------¶Áº¯Êı(ÒÀ¾İÊ±Ğò°æ)--------------*/
  80          static uchar Ds18b20ReadByte(){   //mcuÖ»ÊÇÆğÊÖ·¢ÁËÒ»¸ö¿ªÊ¼µÄ¿ØÖÆĞòÁĞ£¬ºóÃæ×ÜÏßµÄÈ¨Á¦¾Í½»¸øÁËds18b20Ğ¾Æ¬
  81   1              uchar byte = 0,bi = 0;
  82   1              uint i = 0,j = 0;
  83   1              for(j = 0;j < 8;++j){
  84   2                      DSPORT = 0;//ÏÈÀ­µÍÒ»»á´ú±í¿ªÊ¼Ğ´ÁË
  85   2                      i++;
  86   2                      DSPORT = 1;//À­¸ß±íÊ¾È¨Á¦½»³öÈ¥ÁË£¬ds18b20¿ÉÒÔÀ­¸ßÀ­µÍ
  87   2                      i++;
  88   2                      i++; 
  89   2                      //i++;      //Á½¸öÀË·ÑÊ±¼äµÄ¾Ù´ë£¬ÒòÎªÔ­À´ÊÇ0£¬È»ºó×ÜÏßÊÍ·Åµ½ÁË1ĞèÒªÊ±¼ä¡£²ÉÑùµÄÊ±¼äºÜ¶Ì+ds18b20½«Êı¾İ·Å
             -µ½×ÜÏßÒ²ÊÇĞèÒªÊ±¼äµÄ¡£Ì«Ôç×¥²»µ½Êı¾İ£¬Ì«ÍíÁËÊı¾İ¾ÍÃ»ÓĞÁË¡£
  90   2                      bi = DSPORT;//µ¥Æ¬»úÊÕµ½ds18b20µÄ·¢ËÍĞÅÏ¢ºó¾Í´«¸øbi     ,²ÉÑùÊ±¼äºÜ¶Ì
  91   2                      byte = byte | (bi << j);
  92   2                      delay45us();//ÒÀ¾İÊ±ĞòÍ¼£¬ĞèÒª×öÑÓÊ±45us×óÓÒ    
  93   2              }       
  94   1              return byte;            
  95   1      }
  96          
  97          
  98          /*---------------------------------¸ß²ãº¯Êı----------------------------------------------------*/
  99          
 100          /*-----------×ª»»ÎÂ¶È--------------*/
 101          static void DS18b20ADCTemperature(void){         //Õâ¸öº¯ÊıµÄ¹¦ÄÜÊÇÈÃds18b20¿ªÊ¼×ª»»ÎÂ¶ÈÁË £¬È»ºó½«²âºÃµÄ½á¹û·Å¸æ
             -ËßÔİ´æÆ÷ÀïÃæ
 102   1              Ds18b20Init();
 103   1              delay1ms();
 104   1              Ds18b20WriteByte(0xcc);//Ìø¹ıROM²Ù×÷
 105   1              Ds18b20WriteByte(0x44);//ÎÂ¶È×ª»»µÄÖ¸Áî
 106   1              delay750ms();//¸øÒ»¶¨µÄÊ±¼äÈ¥×ªÎÂ¶È£¬Õâ¸ö750usµÄÊ±¼äÊÇÊı¾İÊÖ²áËµµÄ      
 107   1      }
 108          /*-----------¶ÁÈ¡Ôİ´æÆ÷ÀïÃæµÄÎÂ¶ÈÊı¾İ--------------*/
 109          static void DS18b20ReadTemperature(void){
 110   1              Ds18b20Init();
 111   1              delay1ms();
C51 COMPILER V9.01   DS18B20                                                               03/20/2024 01:22:19 PAGE 3   

 112   1              Ds18b20WriteByte(0xcc);  //Ìø¹ırom²Ù×÷
 113   1              Ds18b20WriteByte(0xbe); //·¢ËÍ¶ÁÈ¡ÎÂ¶ÈÃüÁî
 114   1      }
 115          
 116          /*-----------ds18b20ÀïÃæµÄ¾ßÌåÊıÖµ±»´«ËÍ³öÀ´£¨¼¯³ÉÁËÉÏÃæµÄÁ½¸öº¯Êı£©--------------*/
 117          /*uint Ds18b20Readtemperature(void){
 118                  uint temperature = 0;
 119                  uint th,tl;
 120                  DS18b20ADCTemperature();  //¸æËßĞ¾Æ¬¿ÉÒÔ¿ªÊ¼×ª»»ÁË
 121                  DS18b20ReadTemperature(); // ¸æËßĞ¾Æ¬ÎÒÒª¿ªÊ¼¶ÁÄãÁË
 122                  tl = Ds18b20ReadByte();   //¾«¶ÈÊÇ12Î»µÄ£¬µ«ÊÇÊÇÁ½¸ö×Ö½Ú½ÓÊÕµÄ
 123                  th = Ds18b20ReadByte();
 124                  temperature = tl | (th<<8);      //ÒÆ¶¯°ËÎ»ÊÇÎªÁËÒª¿Õ³ö16Î»µÄÎ»ÖÃ£¬È»ºó·½±ãµÍÎ»È¥Æ´½Ó
 125                  
 126                  return temperature;
 127          }*/
 128          
 129          double Ds18b20ReadDecimalTemperature(void){     //Õâ¸öº¯ÊıÊÇÎªÁËÍ¨¹ı´®¿Ú²âÊÔÏÂ¸ß°ËÎ»ºÍµÍ°ËÎ»Êı¾İµ½µ×ÓĞ Ã»ÓĞ¶ÁÈ
             -¡µ½
 130   1              uint temperature = 0;
 131   1              uchar th,tl;
 132   1              double doubleTemperature = 0;
 133   1              DS18b20ADCTemperature();  //¸æËßĞ¾Æ¬¿ÉÒÔ¿ªÊ¼×ª»»ÁË
 134   1              DS18b20ReadTemperature(); // ¸æËßĞ¾Æ¬ÎÒÒª¿ªÊ¼¶ÁÄãÁË
 135   1              tl = Ds18b20ReadByte();   //¾«¶ÈÊÇ12Î»µÄ£¬µ«ÊÇÊÇÁ½¸ö×Ö½Ú½ÓÊÕµÄ
 136   1              th = Ds18b20ReadByte();
 137   1              temperature = tl | (th<<8);      //ÒÆ¶¯°ËÎ»ÊÇÎªÁËÒª¿Õ³ö16Î»µÄÎ»ÖÃ£¬È»ºó·½±ãµÍÎ»È¥Æ´½Ó
 138   1              //temperature = temperature*625/10000;//ÕıÈ·µÄĞ´·¨£¬µ«ÊÇÕâÑù»áÒç³ö      
 139   1      
 140   1              //temperature = temperature*62/1000;      //ËğÊ§ÏÂ¾«¶È£¬ÏÈ¼òµ¥²âÊÔÏÂÄÜ²»ÄÜ·¢
 141   1      
 142   1              doubleTemperature = temperature*0.0625;
 143   1              //uart_send_byte(0);
 144   1              //uart_send_byte((unsigned char)doubleTemperature);  //¾­²âÊÔ£¬ÊÇ¿ÉÒÔ·¢ËÍµ½µÄ£¬×îºóµÄ½á¹û¾ÍÊÇÊ®Áù½øÖÆ
 145   1              //uart_send_byte(th);
 146   1      
 147   1              return doubleTemperature;
 148   1      
 149   1              /* ¶ÁÈ¡½á¹û£º
 150   1              00  6A  01  00  6A  01  00  6A  01  00  6A  01  00  6A  01  00  6A  01  
 151   1              00  6B  01  00  6A  01  00  6D  01  00  7C  01  00 
 152   1               8A  01  00  96  01  00  9E  01  00  A4  01  00  AA  01  00  AF  01  00  00  00  00  
 153   1              */
 154   1      }
 155          
 156          
 157          
 158          
 159          
 160          
 161          
 162          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    278    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.01   DS18B20                                                               03/20/2024 01:22:19 PAGE 4   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
